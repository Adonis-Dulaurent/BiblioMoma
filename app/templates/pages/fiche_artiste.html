{% extends "partials/conteneur.html" %}

{% block contenu %}
    <div class="fiche_artiste">
    <div class="titre_artiste">
        <!-- Titre centrÃ© (nom de l'artiste ou de l'oeuvre) -->
         {% for data in bio %}
        <h2>{{ data.DisplayName }}</h1>

        <!-- Image principale -->
        <div class="image_artiste">
            <img src="{{ image }}" alt="No picture available in the database ðŸš«" class="img-fluid">
        </div>

        <!-- Texte-->
        <div class="texte_artiste"></div>
            <div class="artist_table">
                <h2>Description</h2>
                <p>{{data.DisplayName}} is a {{data.Nationality}} artist who was born in {{data.BirthDate}} and passed away in {{data.DeathDate}}.
                    <h4>Affiliated artistic mouvements</h4>
                    {% for movement in movements %}
                    <li>
                        <ul>{{movement}}</ul>
                    </li>
                    {% endfor %}
                    <h4>Affiliated genres</h4>
                    {% for genre in genres %}
                    <li>
                        <ul>{{genre}}</ul>
                    </li>
                    {% endfor %}
                    <h4>Artworks</h4>
                    <ul>
                        {% for artwork in artworks %}
                        <li>
                            <a href="{{ url_for('fiche_oeuvre', id_oeuvre=artwork[2]) }}">
                                {{ artwork[0] }}
                            </a>
                            <br>
                            <img src="{{ artwork[1] }}" alt="No picture available in the database ðŸš«" class="img-fluid">
                        </li>
                        {% endfor %}
                    </ul>


            </p>
            </div>
        </div>
        {% endfor %}
            <div class="biblio_artiste">
                <h2>Bibliography</h2>
            </div>

        </div>
    </div>
    </div>

    <label for="numResults">Nombre de rÃ©sultats :</label>
    <input type="number" id="numResults" value="10" min="1" max="50">
    <button id="loadBiblio" data-id="{{ bio[0].WikiID }}">ðŸ“š Voir la Bibliographie</button>

    <!-- Zone oÃ¹ la bibliographie va s'afficher -->
    <div id="bibliographyContainer"></div>
    </div>

    <script>
        document.getElementById("loadBiblio").addEventListener("click", function() {
            let idArtist = this.getAttribute("data-id");
            let numResults = document.getElementById("numResults").value;
            let biblioContainer = document.getElementById("bibliographyContainer");
        
            fetch(`/artistes/${idArtist}/bibliography?limit=${numResults}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        biblioContainer.innerHTML = `<p style="color:red;">${data.error}</p>`;
                        return;
                    }
        
                    let biblioHTML = "<h2>Bibliographie</h2><ol>";
                    data.forEach(book => {
                        biblioHTML += `
                            <li>
                                <strong>${book.Title}</strong> (${book.Publication_year})  
                                <br>
                                OpenAlex ID: <a href="${book.OpenAlex_ID}" target="_blank">${book.OpenAlex_ID}</a>
                            </li>`;
                    });
                    biblioHTML += "</ol>";
        
                    biblioContainer.innerHTML = biblioHTML;
                })
                .catch(error => {
                    biblioContainer.innerHTML = `<p style="color:red;">Erreur lors du chargement de la bibliographie.</p>`;
                    console.error("Erreur:", error);
                });
        });
    </script>
        
{% endblock %}