{% extends "partials/conteneur.html" %}

{% block contenu %}
    <div class="fiche_oeuvre">
        <h1>{{ details.Title }}</h1>

        <div class="image_oeuvre">
            <img src="{{ details.ImageURL }}" alt="No picture available" class="img-fluid">
        </div>

        <div class="texte_oeuvre">
            <h2>Description</h2>
            <p>
                "{{ details.Title }}", created by 
                <a href="{{ url_for('fiche_artiste', id_artist=details.ArtistWikiID) }}">
                    {{ details.Artist }}
                </a> 
                in {{ details.BeginningDate }} - {{ details.EndDate }}, is a work housed in the {{ details.Department }}.
            </p>
            
            <p>Classified under the {{ details.Classification }} category, it was acquired by the MoMA in {{ details.DateAcquired }} through {{ details.CreditLine }}. This piece, made with {{ details.Medium }}, measures {{ details.Dimensions }}.</p>
        </div>

        <!-- BOUTON POUR CHARGER LA BIBLIOGRAPHIE -->
        <label for="numResults">Nombre de rÃ©sultats :</label>
        <input type="number" id="numResults" value="10" min="1" max="50">    
        <button id="loadBiblio" data-id="{{ details.id }}">ðŸ“š Voir la Bibliographie</button>

        <!-- Zone oÃ¹ la bibliographie va s'afficher -->
        <div id="bibliographyContainer"></div>
    </div>

    <script>
        document.getElementById("loadBiblio").addEventListener("click", function() {
            let idOeuvre = this.getAttribute("data-id");
            let numResults = document.getElementById("numResults").value;
            let biblioContainer = document.getElementById("bibliographyContainer");

            fetch(`/oeuvres/${idOeuvre}/bibliography?limit=${numResults}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        biblioContainer.innerHTML = `<p style="color:red;">${data.error}</p>`;
                        return;
                    }

                    let biblioHTML = "<h2>Bibliographie</h2><ol>";
                    data.forEach(book => {
                        biblioHTML += `
                            <li>
                                <strong>${book.Title}</strong> (${book.Publication_year})  
                                <br>
                                OpenAlex ID: <a href="${book.OpenAlex_ID}" target="_blank">${book.OpenAlex_ID}</a>
                            </li>`;
                    });
                    biblioHTML += "</ol>";

                    biblioContainer.innerHTML = biblioHTML;
                })
                .catch(error => {
                    biblioContainer.innerHTML = `<p style="color:red;">Erreur lors du chargement de la bibliographie.</p>`;
                    console.error("Erreur:", error);
                });
        });
    </script>
{% endblock %}
