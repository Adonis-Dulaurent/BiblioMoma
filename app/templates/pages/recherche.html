{% extends "partials/conteneur.html" %}

{% block contenu %}
<div>
    <h1>Recherche</h1>
    <form method="GET" action="{{ url_for('recherche', page=1) }}" class="mb-3">
        <input type="text" name="q" placeholder="Rechercher un artiste ou une œuvre..." value="{{ request.args.get('q', '') }}">
        
        <select name="type">
            <option value="">Tous</option>
            <option value="artistes" {% if request.args.get('type') == 'artistes' %}selected{% endif %}>Artistes</option>
            <option value="oeuvres" {% if request.args.get('type') == 'oeuvres' %}selected{% endif %}>Œuvres</option>
        </select>
    
        <button type="submit">Rechercher</button>
    </form>
    
    {% if items %}
    <table class="table">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Image</th>
                <th scope="col">Nom / Titre</th>
                <th scope="col">Date</th>
                <th scope="col">Type</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <th scope="row">{{ loop.index }}</th>

                <!-- Image de l'artiste ou de l'œuvre -->
                <td>
                    {% if item.ImageURL %}
                        <img src="{{ item.ImageURL }}" alt="Artwork Image" width="100">
                    {% elif item.images and item.images[0].Link %}
                        <img src="{{ item.images[0].Link }}" alt="Artist Image" width="100">
                    {% else %}
                        <span>Aucune image</span>
                    {% endif %}
                </td>

                <!-- Nom de l'artiste ou Titre de l'œuvre -->
                <td>
                    {% if item.DisplayName %}
                        <a href="{{ url_for('fiche_artiste', id_artist=item.WikiID)}}">
                            {{ item.DisplayName }}
                        </a>
                    {% else %}
                        <a href="{{ url_for('fiche_oeuvre', id_oeuvre=item.id)}}">
                            {{ item.Title }}
                        </a>
                    {% endif %}
                </td>

                <!-- Dates -->
                <td>
                    {% if item.BirthDate %}
                        {{ item.BirthDate }} - {{ item.DeathDate if item.DeathDate else "présent" }}
                    {% elif item.BeginningDate %}
                        {{ item.BeginningDate }} - {{ item.EndDate if item.EndDate else "?" }}
                    {% else %}
                        Inconnu
                    {% endif %}
                </td>

                <!-- Type (Artiste ou Œuvre) -->
                <td>
                    {% if item.DisplayName %}
                        Artiste
                    {% else %}
                        Œuvre
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- PAGINATION -->
    <nav aria-label="Page navigation">
        <ul class="pagination">
            {% if artists and artists.has_prev %}
                <li class="page-item">
                    <a class="page-link" href="{{ url_for('recherche', page=artists.prev_num, q=request.args.get('q', ''), type=request.args.get('type', '')) }}">Précédent</a>
                </li>
            {% elif artworks and artworks.has_prev %}
                <li class="page-item">
                    <a class="page-link" href="{{ url_for('recherche', page=artworks.prev_num, q=request.args.get('q', ''), type=request.args.get('type', '')) }}">Précédent</a>
                </li>
            {% endif %}

            {% if artists and artists.has_next %}
                <li class="page-item">
                    <a class="page-link" href="{{ url_for('recherche', page=artists.next_num, q=request.args.get('q', ''), type=request.args.get('type', '')) }}">Suivant</a>
                </li>
            {% elif artworks and artworks.has_next %}
                <li class="page-item">
                    <a class="page-link" href="{{ url_for('recherche', page=artworks.next_num, q=request.args.get('q', ''), type=request.args.get('type', '')) }}">Suivant</a>
                </li>
            {% endif %}
        </ul>
    </nav>


    {% else %}
    <p>Aucun résultat trouvé.</p>
    {% endif %}
</div>
{% endblock %}
